{
  "$schema": "http://json-schema.org/draft-07/schema#",
  "title": "Abracadabra Vision Schema",
  "description": "A unified JSON schema to represent human intent as executable scenes across domains (IoT, robotics, VR, etc).",
  "type": "object",
  "properties": {
    "version": {
      "type": "string",
      "const": "abra-0.1.0"
    },
    "intent": {
      "type": "string",
      "description": "A short description of the user's intent"
    },
    "scene": {
      "type": "object",
      "properties": {
        "flow": {
          "type": "array",
          "items": {
            "type": "object",
            "properties": {
              "after": {
                "type": "string",
                "pattern": "^[0-9]+(ms|s)$",
                "description": "Optional delay before this step (e.g. '500ms', '2s')"
              },
              "do": {
                "type": "array",
                "items": {
                  "type": "object",
                  "oneOf": [
                    {
                      "properties": {
                        "lighting": {
                          "type": "object",
                          "properties": {
                            "ref": { "type": "string" },
                            "preset": {
                              "type": "string",
                              "enum": ["dim", "blue", "white", "normal"]
                            }
                          },
                          "required": ["ref", "preset"]
                        }
                      },
                      "required": ["lighting"]
                    },
                    {
                      "properties": {
                        "audio": {
                          "type": "object",
                          "properties": {
                            "ref": { "type": "string" },
                            "play": { "type": ["boolean", "string"] },
                            "stop": { "type": "boolean" }
                          },
                          "additionalProperties": false
                        }
                      },
                      "required": ["audio"]
                    },
                    {
                      "properties": {
                        "screen": {
                          "type": "object",
                          "properties": {
                            "ref": { "type": "string" },
                            "show": { "type": "string" }
                          },
                          "required": ["ref", "show"]
                        }
                      },
                      "required": ["screen"]
                    }
                  ]
                },
                "minItems": 1
              }
            },
            "required": ["do"]
          },
          "minItems": 1
        }
      },
      "required": ["flow"]
    }
  },
  "required": ["version", "intent", "scene"]
}
